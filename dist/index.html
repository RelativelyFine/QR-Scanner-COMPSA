<!DOCTYPE html><html><head><title>COMPSA QR Scanner</title><meta charset="utf-8"><meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><style>html{height:100%}body{height:100%;background:#000;margin:0;padding:0 10px;font-family:sans-serif}h1{color:#fff;margin:0;padding:15px}#container{text-align:center;margin:0}#qr-canvas{width:calc(100% - 20px);max-width:400px;margin:auto}#btn-scan-qr{cursor:pointer}#btn-scan-qr img{height:10em;background:#fff;margin:15px;padding:15px}#qr-result{width:auto;max-width:300px;background-color:#fff;margin:20px auto;padding:20px;font-size:1.2em}#error{width:auto;max-width:300px;background-color:#ff7878;margin:20px auto;padding:20px;font-size:1.2em}#inputdiv{max-width:200px;cursor:pointer;background-color:#fff;margin:20px auto;padding:10px 20px;font-size:1.2em}#backButton{width:243px;cursor:pointer;background-color:#fff;margin:30px 0 20px;padding:20px;font-size:2em}input[type=number]{text-align:center;min-width:100px;width:70%;-moz-appearance:textfield;box-sizing:border-box;margin:0;padding:12px 20px}input::-webkit-outer-spin-button,input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}</style><script>fetch("https://compsa.ca/api/admin/manage");</script><script src="https://rawgit.com/sitepoint-editors/jsqrcode/master/src/qr_packed.js"></script></head><body> <div id="container"> <h1>COMPSA QR Scanner</h1> <a id="btn-scan-qr"> <img src="https://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2017/07/1499401426qr_icon.svg" alt="Button to begin QR scan"> <a> <canvas hidden id="qr-canvas"></canvas> <style></style> <br> <button id="backButton" type="button" hidden>Back</button> <div id="error" hidden> <b>ERROR!</b> <span id="errorData"></span> </div> <div id="inputdiv"> <b>Award ID:</b> <form> <label for="award-id"></label> <input type="number" id="award-id" name="award-id" placeholder="Award ID"><br> </form> </div> <div id="qr-result" hidden> <b>Data:</b> <span id="outputData"></span> </div> </a></a></div> <script>const qrcodeBtn=window.qrcode,video=document.createElement("video"),canvasElement=document.getElementById("qr-canvas"),canvas=canvasElement.getContext("2d"),qrResult=document.getElementById("qr-result"),outputData=document.getElementById("outputData"),btnScanQR=document.getElementById("btn-scan-qr"),backButton=document.getElementById("backButton"),error=document.getElementById("error"),errorData=document.getElementById("errorData");let scanning=!1;qrcodeBtn.callback=async e=>{await closeQR(e)},backButton.onclick=async e=>{await closeQR(e)};const closeQR=async e=>{e&&(scanning=!1,video.srcObject.getTracks().forEach((e=>{e.stop()})),"click"==e.type?outputData.innerText="Scan Cancelled!":(outputData.innerText=e,await backendInterface(e)),qrResult.hidden=!1,backButton.hidden=!0,canvasElement.hidden=!0,btnScanQR.hidden=!1)};function tick(){canvasElement.height=video.videoHeight,canvasElement.width=video.videoWidth,canvas.drawImage(video,0,0,canvasElement.width,canvasElement.height),scanning&&requestAnimationFrame(tick)}function scan(){try{qrcode.decode()}catch(e){setTimeout(scan,300)}}async function backendInterface(e){net_id=await JSON.parse(e).net_id,award_id=await document.getElementById("award-id").value,url=`https://compsa.ca/api/admin/manage?net_id=${net_id}&award_id=${award_id}`,await fetch(url,{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}}).then((e=>{console.log(e),error.hidden=!0,errorData.innerText=""})).catch((e=>{console.log(e),error.hidden=!1,errorData.innerText=e}))}btnScanQR.onclick=()=>{navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then((function(e){backButton.hidden=!1,scanning=!0,qrResult.hidden=!0,btnScanQR.hidden=!0,canvasElement.hidden=!1,video.setAttribute("playsinline",!0),video.srcObject=e,video.play(),tick(),scan()}))};</script> </body></html>